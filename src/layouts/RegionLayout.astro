---
import BaseLayout from './BaseLayout.astro';
import type { CollectionEntry } from 'astro:content';
import { createRegionPageSchema, createBreadcrumbSchema } from '../lib/schema/factories';
import Breadcrumbs from '@/components/Breadcrumbs.astro';


interface Props {
  region: CollectionEntry<'regions'>;
}

const { region } = Astro.props;

const regionDetails = {
  name: region.data.title,
  url: `https://goflow.plumbing/${region.slug}/`,
  description: region.data.description,
  image: region.data.heroImage
};

const schema = await createRegionPageSchema({
  ...regionDetails,
  cityName: region.data.location || region.data.region || region.data.title
});
const currentCrumbName = region.data.breadcrumbDisplayText ?? region.data.linkText ?? region.data.menuText ?? region.data.title;
const breadcrumbItems = [
  { name: 'Home', url: 'https://goflow.plumbing/' },
  { name: 'Service Regions', url: 'https://goflow.plumbing/service-regions/' },
  { name: currentCrumbName, url: `https://goflow.plumbing/${region.slug}/` }
];
const breadcrumbSchema = await createBreadcrumbSchema(breadcrumbItems);

const { Content } = await region.render();

---

<BaseLayout 
  title={region.data.title}
  description={region.data.description}
  schema={[schema, breadcrumbSchema]}
>
  <article class="article">
    <Breadcrumbs items={[{ name: 'Home', path: '/' }, { name: 'Service Regions', path: '/service-regions/' }, { name: currentCrumbName }]} />
    <div class="markdown-content">
      <Content />
    </div>

    <div class="call-to-action">
      <h2>Need Plumbing Service in {region.data.region}?</h2>
      <p>Our local experts are ready to help with all your plumbing needs.</p>
      <a href="/contact-us/">
        Schedule Service
      </a>
    </div>
  </article>
</BaseLayout>
