---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { sortByPositionThenTitle } from '../lib/sortByPositionThenTitle';
import { createHomePageSchemas } from '../lib/schema/factories';
import '../styles/pages/index.css';

interface ServiceFrontmatter {
  featured: boolean;
  draft: boolean;
  title: string;
  description: string;
  linkText?: string;
  menuText?: string;
  name?: string;
  position?: number;
}

const featuredServices = await getCollection('services', ({ data }: { data: ServiceFrontmatter }) => 
  data.featured && !data.draft
);

const sortedFeaturedServices = sortByPositionThenTitle(
  featuredServices,
  service => service.data.position,
  service => service.data.name || service.data.menuText || service.data.linkText || service.data.title
);

// Homepage gets WebSite + WebPage schemas
const homePageSchemas = await createHomePageSchemas();

---

<BaseLayout
  title="GoFlow Plumbing | Sonoma & Marin County Plumbers"
  description="3rd generation plumbers serving Sonoma & Marin County. Water heater repair, drain cleaning, leak detection & 24/7 emergency service. Call (707) 200-8350."
  schema={homePageSchemas}
>
  <div>

    <!-- Hero Section -->
    <section class="hero">
      <!-- <picture>
        <source srcset="/images/generated/celtic-1280.jpg 1280w, /images/generated/celtic-1024.jpg 1024w, /images/generated/celtic-768.jpg 768w, /images/generated/celtic-640.jpg 640w, /images/generated/celtic-320.jpg 320w" sizes="100vw" />
        <img
          class="hero-bg"
          src="/images/generated/celtic-768.jpg"
          alt="GoFlow Plumbing hero"
          loading="eager"
          decoding="async"
          fetchpriority="high"
        />
      </picture> -->
      <div class="hero-container">
        <h1>3rd Generation Plumbing Experts</h1>
        <div class="hero-text">
          <p>
            Make your plumbing problem ours.
            Put our courteous experts to work for you.
            Your home will be treated better than if it was our own mom's.
            Sorry, mom.
          </p>
        </div>
        <div class="space-x-4">
          <a href="/contact-us/" class="btn btn-primary">Contact Us Now</a>
          <a href="/plumbing-services/" class="btn btn-secondary">Our Services</a>
        </div>
      </div>
    </section>

    <!-- Featured Services -->
    <section class="services">
      <div class="services-container">
        <!-- <h2>Our Services</h2> -->
        <div>
          {sortedFeaturedServices.map((service: any) => (
            <div>
              <h3>{service.data.title}</h3>
              <p class="mb-4">{service.data.description}</p>
              <a href={`/${service.slug}/`}>
                {service.data.linkText ? `Get ${service.data.linkText}` : 'Learn More'}
              </a>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Customer Reviews -->
    <section class="reviews">
      <div>
        <h2>What Our Customers Say</h2>
        <div class="reviews-grid">
          <div class="review-card">
            <div class="review-header">
              <span class="reviewer-name">Kip B.</span>
              <span class="review-date">Oct 2024</span>
            </div>
            <div class="review-rating">★★★★★</div>
            <div class="review-service">Water Heater Installation and Replacement</div>
            <p class="review-text">Chris knows what he's doing, is very conscientious and takes all the time necessary to get the job done right. His prices are the most reasonable I've found. He's my new plumber, highly recommended.</p>
          </div>
          <div class="review-card">
            <div class="review-header">
              <span class="reviewer-name">Bert P.</span>
              <span class="review-date">Sep 2024</span>
            </div>
            <div class="review-rating">★★★★★</div>
            <div class="review-service">Water Heater Installation and Replacement</div>
            <p class="review-text">Chris was prompt to reply to your texts. Chris was conscientious about letting you know he was going to be a little late and why. He was very polite, clean and organized. The job was completed faster than I expected. I am extremely pleased with his work and will highly recommend him. Would not hesitate to used him again. He also had a very competitive price.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Why Choose Us -->
    <section class="choose-us">
      <div>
        <h2>Why Choose GoFlow Plumbing?</h2>
        <div>
          <div>
            <h3>24/7 Emergency Service</h3>
            <p>Available around the clock for all your plumbing emergencies</p>
          </div>
          <div>
            <h3>Licensed & Insured</h3>
            <p>Professional, experienced, and fully certified plumbers</p>
          </div>
          <div>
            <h3>Fair & Honest Pricing</h3>
            <p>Transparent pricing with no hidden fees or surprises</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Service Areas -->
    <section class="service-areas">
      <div>
        <h2>Service Areas</h2>
        <div>
          <div>
            <a href="/sonoma-county-plumbing/">
              <h3>Sonoma County</h3>
              <p>Serving all of Sonoma County with expert plumbing services</p>
            </a>
          </div>
          <div>
            <a href="/marin-county-plumbing/">
              <h3>Marin County</h3>
              <p>Professional plumbing services throughout Marin County</p>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Top Services In Your Area -->
    <section class="top-services">
      <div>
        <h2>Top Services in Your Area</h2>
        <ul>
          <li><a href="/water-heater-repair-san-rafael/">San Rafael Water heater repair</a></li>
          <li><a href="/water-heater-repair-santa-rosa/">Santa Rosa Water heater repair</a></li>
          <li><a href="/water-heater-repair-novato/">Novato Water heater repair</a></li>
          <li><a href="/water-heater-installation-petaluma/">Petaluma Water heater installation</a></li>
          <li><a href="/water-heater-install/">Water heater install</a></li>
          <li><a href="/water-heater-repair-and-replacement/">Water heater repair and replacement</a></li>
          <li><a href="/drain-cleaning-san-rafael/">San Rafael Drain cleaning</a></li>
          <li><a href="/drain-cleaning-santa-rosa/">Santa Rosa Drain cleaning</a></li>
          <li><a href="/drain-cleaning-novato/">Novato Drain cleaning</a></li>
          <li><a href="/drain-cleaning-petaluma/">Petaluma Drain cleaning</a></li>
        </ul>
      </div>
    </section>

    <!-- CTA Section -->
    <section class="cta">
      <div>
        <h2>Need a Plumber?</h2>
        <p>Contact us now for fast, reliable service</p>
        <a href="/contact-us/">
          Get in Touch
        </a>
    </div>
  </section>
</BaseLayout>
